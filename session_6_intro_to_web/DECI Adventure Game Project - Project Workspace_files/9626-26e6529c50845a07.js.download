"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9626],{59626:function(e,t,n){n.d(t,{Y:function(){return q}});var o=n(80969),i=n(85893),r=n(67294),a=n(5152),u=n.n(a),l=n(26793),d=n(18618),s=n(57747),c=n(93717),f=n(3579),p=n(80438),v=n(36112),y=n(44234),h=n(8739),m=n(71293),x=n(35742),_=n(17090),b=n(42642),g=n(34062),k=n(4419),P=n(95040),j=n(35614),T=n(67649),I=n(51957),w=n(34727),C=n(14251),S=n(52875),z=n(70655),E=n(86492),K=n.n(E),R=n(42201),O=n(24435),V=n(33943),A=function(e){var t=e.onToggle,n=e.isOpen,r=(0,l.$)().t,a=(0,o.Z)((0,d.a)(["(max-width: 480px)"]),1)[0];return(0,i.jsx)(f.z,{display:"flex",variant:"unstyled",onClick:t,color:"blue.500",zIndex:"low",size:"xs",padding:0,children:n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(b.Two,{w:6,h:6}),a?null:r("lesson.hideVideoTranscript")]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(b.dtP,{w:6,h:6}),r("lesson.showVideoTranscript")]})})},D=u()((function(){return n.e(6830).then(n.bind(n,26830)).then((function(e){return e.UreactPlayer}))}),{loadableGenerated:{webpack:function(){return[26830]}},ssr:!1}),q=function(e){var t,n,a,u,l=e.video,c=e.autoPlay,f=void 0!==c&&c,p=e.atomKey,v=null!==(a=(0,I.D)())&&void 0!==a?a:"",y=null!==(u=(0,V.sq)())&&void 0!==u?u:"",h=(0,r.useState)(!1),m=h[0],x=h[1],_=(0,r.useState)(0),b=_[0],j=_[1],T=(0,r.useRef)(0),w=(0,o.Z)((0,d.a)(["(max-width: 480px)"]),1)[0],C=(0,g.DK)({userId:y,programKey:v}),S=C.data,z=C.isLoading,E=(0,P.z)().trackVideo,K=(0,k.p)(),R=K.data,O=K.isLoading,A=(0,r.useRef)(null),q=function(){m||E({videoPlayerType:Z(A)?"youtube":"html",eventIdentification:"exit",additionalProperties:{atom_key:p,video_end_time:T.current/1e3}})};(0,r.useEffect)((function(){return function(){q()}}),[]),(0,r.useEffect)((function(){return window.addEventListener("beforeunload",q),function(){window.removeEventListener("beforeunload",q)}}),[]);var B,L=null===S||void 0===S||null===(t=S.user)||void 0===t||null===(n=t.classroom)||void 0===n?void 0:n.useInternalVideoPlayer,Y=Boolean(L&&l.topherId),F=l.youtubeId,N=l.topherId;return F||N?(0,i.jsxs)(s.xu,{alignSelf:"normal",border:"1px solid",borderColor:"gray.200",padding:w?"16px":"40px",paddingBottom:"49px",rounded:"md",overflow:"hidden",children:[!z&&!O&&(0,i.jsx)(D,{playerRef:A,youtubeId:F,topherId:N,isAlternativePlayer:Y,autoPlay:f,countryCode:null!==(B=null===R||void 0===R?void 0:R.countryCode)&&void 0!==B?B:"US",onProgress:function(e){var t=e.playedSeconds,n=Math.floor(1e3*t);j(n),T.current=n},onPlay:function(){E({videoPlayerType:Z(A)?"youtube":"html",eventIdentification:"play",additionalProperties:{atom_key:p,video_start_time:b/1e3}})},onPause:function(){E({videoPlayerType:Z(A)?"youtube":"html",eventIdentification:"pause",additionalProperties:{atom_key:p,video_end_time:b/1e3}})},onSeek:function(e){E({videoPlayerType:Z(A)?"youtube":"html",eventIdentification:"seek",additionalProperties:{atom_key:p,video_start_time:b/1e3,video_end_time:e}})},onError:function(e){E({videoPlayerType:Z(A)?"youtube":"html",eventIdentification:"error",additionalProperties:{atom_key:p,video_start_time:b/1e3,video_end_time:e}})},onVolumeChange:function(e){E({videoPlayerType:Z(A)?"youtube":"html",eventIdentification:"volume",additionalProperties:{atom_key:p,video_start_time:b/1e3,volume:e}})},onSubtitleChange:function(e){E({videoPlayerType:Z(A)?"youtube":"html",eventIdentification:"subtitle",additionalProperties:{atom_key:p,video_start_time:b/1e3,language:e}})},onPlaybackRateChange:function(e){E({videoPlayerType:Z(A)?"youtube":"html",eventIdentification:"video speed",additionalProperties:{atom_key:p,video_start_time:b/1e3,updated_speed:e}})},onEnded:function(){x(!0),E({videoPlayerType:Z(A)?"youtube":"html",eventIdentification:"completed",additionalProperties:{atom_key:p,video_end_time:b/1e3}})}}),(0,i.jsx)(M,{content:l.subtitles_vtt_url,currentTime:b,atomKey:p,onSeek:function(e){A.current&&A.current.seekTo(e)},isYoutubePlayer:Z(A)})]}):null},M=function(e){var t=e.content,n=e.currentTime,o=e.isYoutubePlayer,a=e.atomKey,u=e.onSeek,d=(0,l.$)().t,s=(0,r.useState)(!1),g=s[0],k=s[1],I=(0,r.useState)(0),E=I[0],V=I[1],D=(0,P.z)().trackVideo,q=(0,T._)().hasAiIntegration,M=(0,r.useRef)(null),Z=(0,r.useRef)([]),B=function(e){var t=(0,r.useState)([]),n=t[0],o=t[1];return(0,r.useEffect)((function(){if(e){var t=function(){var t=(0,w.Z)((function(){var t,n,i,r,a;return(0,z.__generator)(this,(function(u){switch(u.label){case 0:return u.trys.push([0,3,,4]),[4,fetch(e)];case 1:return[4,u.sent().text()];case 2:return t=u.sent(),n=t.replace(/<[^>]+>/g,""),i=(0,R.Q)(n).entries,r=i.map((function(e){return(0,S.Z)((0,C.Z)({},e),{text:(t=e.text,K().decode(t))});var t})),o(r),[3,4];case 3:return a=u.sent(),console.error("Failed to fetch subtitles:",a),[3,4];case 4:return[2]}}))}));return function(){return t.apply(this,arguments)}}();t()}}),[e]),n}(t),L=(0,j.hb)(),Y=L.queueMessage,F=L.onOpen,N=(0,r.useCallback)((function(e){var t,n=Z.current[e];n&&(null===(t=M.current)||void 0===t||t.scroll(0,e>2?n.offsetTop-96:0))}),[]);(0,r.useEffect)((function(){var e=B.findIndex((function(e){return n>=e.from&&n<e.to}));-1!==e&&e!==E&&(V(e),N(e))}),[n,B,E,N]);var U=function(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),o=Math.floor(t%60);return"".concat(n,":").concat(String(o).padStart(2,"0"))};return B.length?(0,i.jsxs)(c.k,{gap:"1em",flexDirection:"column",position:"relative",children:[(0,i.jsxs)(c.k,{position:"absolute",right:0,top:3,justify:"end",gap:1,zIndex:"docked",children:[(0,i.jsx)(A,{onToggle:function(){var e=!g;k(e),D({videoPlayerType:o?"youtube":"html",eventIdentification:"transcript",additionalProperties:{atom_key:a,video_start_time:n/1e3,updated_state:e?"on":"off"}}),(0,O.j)(e?"Open Transcript":"Close Transcript",{type:"click",label:"".concat(e?"Open":"Close"," Transcript Clicked - Transcripts")})},isOpen:g}),q&&(0,i.jsx)(f.z,{onClick:function(){Y("Summarize this video"),F()},leftIcon:(0,i.jsx)(b.kBi,{w:6,h:6}),variant:"ghost",size:"xs",color:"blue.500",_hover:{bg:"transparent"},_active:{color:"blue.500"},sx:{"> .chakra-button__icon":{me:1}},children:d("lesson.summarizeVideo")})]}),(0,i.jsx)(p.R,{in:g,offsetY:"40px",unmountOnExit:!0,children:(0,i.jsxs)(v.m,{height:g?"250px":"0",transition:"all 0.5s ease-in-out",children:[(0,i.jsx)(y.t,{justifyContent:"space-between",children:(0,i.jsx)(h.O,{_selected:{borderColor:"transparent"},padding:"12px 0",children:(0,i.jsx)(m.x,{color:"black",fontWeight:"medium",children:d("lesson.videoTranscript")})})}),(0,i.jsx)(x.n,{height:"100%",children:(0,i.jsx)(_.x,{px:0,py:0,children:(0,i.jsx)(c.k,{ref:M,position:"relative",height:"250px",gap:"1em",paddingTop:"1em",paddingBottom:"1em",flexDirection:"column",overflow:"auto",sx:{scrollbarWidth:"thin"},children:B.map((function(e,t){return(0,i.jsxs)(c.k,{as:"button",ref:function(e){return Z.current[t]=e},color:E===t?"black":"gray.500",_hover:{color:"blue.500"},cursor:"pointer",flexDirection:"row",alignItems:"center",textAlign:"left",gap:"16px",transition:"all 0.3s",onClick:function(){return function(e){var t=e.from/1e3,n=B.findIndex((function(e){return t>=e.from/1e3&&t<e.to/1e3}));-1!==n&&(V(n),N(n)),u(t),(0,O.j)("Transcript Subtitle Click",{type:"click",label:"Transcript Subtitle Clicked - Transcripts"})}(e)},children:[(0,i.jsx)(m.x,{textAlign:"center",size:"caption",children:U(e.from)}),(0,i.jsx)(m.x,{children:e.text})]},e.from)}))})})})]})})]}):null};function Z(e){var t,n=null===(t=e.current)||void 0===t?void 0:t.props.url;return(null===n||void 0===n?void 0:n.includes("youtube"))||(null===n||void 0===n?void 0:n.includes("youtu.be"))}},51957:function(e,t,n){n.d(t,{D:function(){return i}});var o=n(11163),i=function(){var e,t,n,i,r,a=(0,o.useRouter)(),u=null!==(r=null!==(i=null===(e=a.query)||void 0===e?void 0:e.nanodegreeKey)&&void 0!==i?i:null===(t=a.query)||void 0===t?void 0:t.paidCourseKey)&&void 0!==r?r:null===(n=a.query)||void 0===n?void 0:n.courseKey;return Array.isArray(u)?null===u||void 0===u?void 0:u[0]:u}}}]);